<div class="shpdd">
    <label>Umbrous (Sable Factor):</label>
    <select id="umbrous">
        <option value="++" selected>No (++)</option>
        <option value="U">Yes (U_)</option>
    </select>
</div>

<div id="combination-lookup" style="display: none;">
    <select id="offspring-phenotype-list">
        <option value="bbdgdg">Beige</option>
        <option value="bbLglg">Black Eyed Blonde</option>
        <option value="bbToTo">Black Eyed Honey</option>
        <option value="bbToY">Black Eyed Honey</option>
        <option value="dgdgee">Black Eyed Ivory</option>
        <option value="eeSgSg">Black Eyed White</option>
        <option value="Lglgpp">Blonde</option>
        <option value="ppSgSg">Blonde (Sg var.)</option>
        <option value="aabbpp">Champagne</option>
        <option value="aabb">Chocolate</option>
        <option value="aapp">Dove</option>
        <option value="dgdgpp">Lilac</option>
        <option value="eepp">Red Eyed Cream</option>
        <option value="eeU">Sable</option>
        <option value="eeppU">Mink</option>
        <option value="dgdgeeppU">Blue Mink</option>
        <option value="bbeeppU">Copper</option>
        <option value="dgdgeeU">Dark Grey Sable</option>
    </select>
</div>

<script>
const SHP = {
    "a": { type: "recessive" }, "p": { type: "recessive" }, "e": { type: "recessive" },
    "b": { type: "recessive" }, "dg": { type: "recessive" }, "ce": { type: "recessive" },
    "cd": { type: "recessive" }, "l": { type: "recessive" }, "rx": { type: "recessive" },
    "Sa": { type: "dominant" }, "hr": { type: "recessive" }, "Ba": { type: "dominant" },
    "Ds": { type: "dominant" }, "rd": { type: "recessive" }, "Wh": { type: "dominant" },
    "s": { type: "recessive" }, "Sg": { type: "incomplete_dominant" },
    "Lg": { type: "incomplete_dominant" }, "To": { type: "sex_linked" },
    "U": { type: "dominant" } // Added Umbrous Gene
};

// ... keep your children() function the same ...

function updateResult() {
    const sex = document.getElementById('offspringssex').value;
    // Added 'umbrous' to the combined strings
    const combined = ['dad', 'mom', 'coat-type', 'pattern', 'umbrous'].map(id => document.getElementById(id).value).join('');
    
    const cLg = (combined.match(/Lg/g) || []).length;
    const cDs = (combined.match(/Ds/g) || []).length;
    const cWh = (combined.match(/Wh/g) || []).length;

    const traits = children(combined, sex);
    // Added "U" to the filter so it stays with the base genotype for the lookup
    let baseGenotype = traits.filter(t => !["ll", "rxrx", "Sasa", "hrhr", "Ba", "Ds", "rd", "Wh", "ss", "Toto"].includes(t)).sort().join('') || "++";

    let baseName = "Golden Agouti";
    const lookup = document.getElementById('offspring-phenotype-list');
    for (let opt of lookup.options) { if (opt.value === baseGenotype) { baseName = opt.text; break; } }

    let mods = [];
    if (traits.includes("Ba")) mods.push("Banded");
    if (traits.includes("Ds")) mods.push("Dominant Spot");
    if (traits.includes("Wh")) mods.push("Roan");
    if (traits.includes("Toto")) mods.push("Tortoiseshell");
    
    let tex = traits.includes("ll") ? "Longhair" : traits.includes("rxrx") ? "Rex" : traits.includes("Sasa") ? "Satin" : traits.includes("hrhr") ? "Hairless" : "Shorthair";

    document.getElementById('offspring-result-name').innerText = `${baseName} ${mods.join(' ')} ${tex}`.replace(/\s+/g, ' ').trim();
    
    let msg = `Genotype: ${traits.join(' ')}`;
    if (cLg >= 2 || cDs >= 2) msg += ` | Lethal combination: Litter size reduced by 25%.`;
    if (cWh >= 2) msg += ` | Caution: Eyeless White pups (Anophthalmic) likely.`;
    
    document.getElementById('genotype-label').innerText = msg;
    document.getElementById('offspring-visual').src = `images/${baseGenotype}.png`;
}

// Ensure 'umbrous' is in the listener list
['offspringssex', 'dad', 'mom', 'coat-type', 'pattern', 'eye-color', 'umbrous'].forEach(id => {
    const el = document.getElementById(id);
    if(el) el.onchange = updateResult;
});
updateResult();
</script>