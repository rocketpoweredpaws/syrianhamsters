<div class="shp">
    <label>Sex of Offspring:</label>
    <select id="offspringssex">
        <option value="female">Female</option>
        <option value="male">Male</option>
    </select>
</div>

<div class="shpdropdown">
    <label>Breeding Male (Father) Coat Color:</label>
    <select id="dad">
        <option value="++">Golden (+)</option>
        <option value="aa">Black (aa)</option>
        <option value="pp">Cinnamon (pp)</option>
        <option value="ee">Cream (ee)</option>
        <option value="aapp">Dove (aapp)</option>
        <option value="cdcd">Dark Eared White (cdcd)</option>
        <option value="dgdg">Dark Grey (dgdg)</option>
        <option value="cece">Extreme Dilute (cece)</option>
        <option value="Lglg">Light Grey (Lglg)</option>
        <option value="bb">Rust (bb)</option>
        <option value="SgSg">Silver Grey (SgSg)</option>
        <option value="ToY">Yellow (ToY)</option>
    </select>
</div>

<div class="shpdropdown">
    <label>Dam (Mother) Coat Color:</label>
    <select id="mom">
        <option value="++">Golden (+)</option>
        <option value="aa">Black (aa)</option>
        <option value="pp">Cinnamon (pp)</option>
        <option value="ee">Cream (ee)</option>
        <option value="aapp">Dove (aapp)</option>
        <option value="cdcd">Dark Eared White (cdcd)</option>
        <option value="dgdg">Dark Grey (dgdg)</option>
        <option value="cece">Extreme Dilute (cece)</option>
        <option value="Lglg">Light Grey (Lglg)</option>
        <option value="bb">Rust (bb)</option>
        <option value="SgSg">Silver Grey (SgSg)</option>
        <option value="ToTo">Yellow (ToTo)</option>
    </select>
</div>

<hr>

<div class="shpdropdown">
    <label>Coat Type:</label>
    <select id="coat-type">
        <option value="Shorthair">Shorthair</option>
        <option value="ll">Longhair</option>
        <option value="Sasa">Satin</option>
        <option value="rxrx">Rex</option>
    </select>
</div>

<div class="shpdropdown">
    <label>Pattern & Dilution:</label>
    <select id="pattern">
        <option value="none">None (Solid)</option>
        <option value="Ba_">Banded</option>
        <option value="Dsds">Dominant Spot</option>
        <option value="Toto">Tortoiseshell (Females Only)</option>
        <option value="dgdg">Dark Grey (Dilution)</option>
    </select>
</div>

<div class="shpdropdown">
    <label>Eye Color:</label>
    <select id="eye-color">
        <option value="black">Black</option>
        <option value="red">Red-OR-Pink</option>
    </select>
</div>

<div id="combination-lookup" style="display: none;">
    <select id="offspring-phenotype-list">
        <option value="bbdgdg">Beige (bbdgdg)</option>
        <option value="bbLglg">Black Eyed Blonde (bbLglg)</option>
        <option value="bbToTo">Black Eyed Honey (bbToTo/bbToY)</option>
        <option value="dgdgee">Black Eyed Ivory (dgdgee/eeLglg/eeSgsg)</option>
        <option value="eeSgSg">Black Eyed White (eeSgSg)</option>
        <option value="Lglgpp">Blonde (Lglgpp)</option>
        <option value="ppSgSg">Blonde - Sg var. (ppSgSg)</option>
        <option value="dgdgeeppU_">Blue Mink (dgdgeeppU_)</option>
        <option value="aabbpp">Champagne (aabbpp)</option>
        <option value="aabb">Chocolate - Black var. (aabb)</option>
        <option value="bbeeU_">Chocolate - Sable var. (bbeeU_)</option>
        <option value="bbeeppU_">Copper (bbeeppU_)</option>
        <option value="dgdgeeU_">Dark Grey Sable (dgdgeeU_)</option>
        <option value="aaSg_">Dingy Black (aaSg_)</option>
        <option value="aapp">Dove (aapp)</option>
        <option value="cdcdpp">Flesh Eared White (cdcdpp)</option>
        <option value="ppToTo">Honey (ppToTo/ppToY)</option>
        <option value="eeLglgU_">Light Grey Sable (eeLglgU_)</option>
        <option value="dgdgpp">Lilac (dgdgpp)</option>
        <option value="dgdgppToTo">Lilac Pearl (dgdgppToTo/dgdgppToY)</option>
        <option value="eeppU_">Mink / Caramel (eeppU_)</option>
        <option value="bbee">Pale Eared Cream (bbee)</option>
        <option value="eepp">Red Eyed Cream (eepp)</option>
        <option value="dgdgeepp">Red Eyed Ivory (dgdgeepp/eeLglgpp/eeppSgsg)</option>
        <option value="eeU_">Sable (eeU_)</option>
        <option value="eeSgSgU_">Silver Sable (eeSgSgU_)</option>
        <option value="dgdgToTo">Smoke Pearl (dgdgToTo/dgdgToY)</option>
        <option value="aaToTo">Yellow Black (aaToTo/aaToY)</option>
    </select>
</div>

<div id="result-display">
    <h3>Predicted Offspring:</h3>
    <div id="offspring-result-name">--</div>
    <img id="offspring-visual" src="" alt="" style="max-width: 200px; display: none;">
</div>

<script>
// 1. DATA: Genetic rules
const geneRules = {
    "a": { type: "recessive", name: "Black" },
    "p": { type: "recessive", name: "Cinnamon" },
    "e": { type: "recessive", name: "Cream" },
    "b": { type: "recessive", name: "Rust" },
    "dg": { type: "recessive", name: "Dark Grey" },
    "ce": { type: "recessive", name: "Extreme Dilute" },
    "cd": { type: "recessive", name: "Dark Eared White" },
    "l": { type: "recessive", name: "Longhair" },
    "rx": { type: "recessive", name: "Rex" },
    "Ba": { type: "dominant", name: "Banded" },
    "Ds": { type: "dominant", name: "Dominant Spot" },
    "Sa": { type: "dominant", name: "Satin" },
    "Sg": { type: "incomplete_dominant", name: "Silver Grey" },
    "Lg": { type: "incomplete_dominant", name: "Light Grey" },
    "To": { type: "sex_linked", name: "Yellow" }
};

// 2. LOGIC: Determining phenotype based on sex and rules
function determineAppearance(genotype, sex) {
    let phenotype = [];
    const count = (gene) => (genotype.match(new RegExp(gene, "g")) || []).length;

    for (let gene in geneRules) {
        const rule = geneRules[gene];

        // Handle Sex-Linked Yellow (ToY vs ToTo vs Toto)
        if (rule.type === "sex_linked") {
            const toCount = count("To");
            if (sex === "male") {
                if (toCount >= 1) phenotype.push("ToY"); 
            } else {
                if (toCount >= 2) phenotype.push("ToTo"); 
                else if (toCount === 1) phenotype.push("Toto"); 
            }
            continue;
        }

        if (rule.type === "recessive") {
            if (count(gene) >= 2) phenotype.push(gene);
        } 
        else if (rule.type === "dominant") {
            if (count(gene) >= 1) phenotype.push(gene);
        } 
        else if (rule.type === "incomplete_dominant") {
            if (count(gene) >= 2) {
                phenotype.push(gene + gene);
            } else if (count(gene) === 1) {
                phenotype.push(gene);
            }
        }
    }

    let finalGenotype = phenotype.sort().join('');
    if (finalGenotype === "") finalGenotype = "++";
    return finalGenotype;
}

// 3. EVENT LISTENERS: Auto-updating the display
const inputs = ['offspringssex', 'dad', 'mom', 'coat-type', 'pattern', 'eye-color'];

inputs.forEach(id => {
    document.getElementById(id).addEventListener('change', updateResult);
});

function updateResult() {
    const sex = document.getElementById('offspringssex').value;
    const dadVal = document.getElementById('dad').value;
    const momVal = document.getElementById('mom').value;
    
    // Combine genetic inputs
    let combinedGenotype = dadVal + momVal;
    
    // Determine visual code
    const appearanceGenotype = determineAppearance(combinedGenotype, sex);
    
    // Search the lookup table
    const lookupList = document.getElementById('offspring-phenotype-list');
    let displayName = "";

    for (let i = 0; i < lookupList.options.length; i++) {
        if (lookupList.options[i].value === appearanceGenotype) {
            displayName = lookupList.options[i].text;
            break;
        }
    }

    // Fallback to base color names if not a combination
    if (!displayName) {
        if (appearanceGenotype === "++") {
            displayName = "Golden (++)";
        } else {
            displayName = "Resulting Genotype: " + appearanceGenotype;
        }
    }

    // Update the HTML
    document.getElementById('offspring-result-name').innerText = displayName;
    
    // Update Image (assuming images are named like 'aa.png' or 'bbdgdg.png')
    const imgElement = document.getElementById('offspring-visual');
    imgElement.src = `images/${appearanceGenotype}.png`;
    imgElement.style.display = "block";
}

updateResult();
</script>