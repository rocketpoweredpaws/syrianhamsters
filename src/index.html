<script>
const geneticruling = {
    "a": { type: "recessive", name: "Black" },
    "p": { type: "recessive", name: "Cinnamon" },
    "e": { type: "recessive", name: "Cream" },
    "b": { type: "recessive", name: "Rust" },
    "dg": { type: "recessive", name: "Dark Grey" },
    "ce": { type: "recessive", name: "Extreme Dilute" },
    "cd": { type: "recessive", name: "Dark Eared White" },
    "l": { type: "recessive", name: "Longhair" },
    "rx": { type: "recessive", name: "Rex" },
    "Sa": { type: "dominant", name: "Satin" },
    "hr": { type: "recessive", name: "Hairless" },
    "Ba": { type: "dominant", name: "Banded" },
    "Ds": { type: "dominant", name: "Dominant Spot" },
    "rd": { type: "recessive", name: "Recessive Dappled" },
    "Wh": { type: "dominant", name: "Roan" },
    "s": { type: "recessive", name: "Piebald" },
    "Sg": { type: "incomplete_dominant", name: "Silver Grey" },
    "Lg": { type: "incomplete_dominant", name: "Light Grey" },
    "To": { type: "sex_linked", name: "Yellow" }
};

function figureoutlooks(genotype, sex) {
    let phenotypeTraits = [];
    const count = (gene) => (genotype.match(new RegExp(gene, "g")) || []).length;

    for (let gene in geneticruling) {
        const rule = geneticruling[gene];
        if (rule.type === "sex_linked") {
            const toCount = count("To");
            if (sex === "male" && toCount >= 1) phenotypeTraits.push("ToY");
            else if (sex === "female") {
                if (toCount >= 2) phenotypeTraits.push("ToTo");
                else if (toCount === 1) phenotypeTraits.push("Toto");
            }
            continue;
        }
        if (rule.type === "recessive" && count(gene) >= 2) phenotypeTraits.push(gene);
        else if (rule.type === "dominant" && count(gene) >= 1) phenotypeTraits.push(gene);
        else if (rule.type === "incomplete_dominant") {
            if (count(gene) >= 2) phenotypeTraits.push(gene + gene);
            else if (count(gene) === 1) phenotypeTraits.push(gene);
        }
    }
    return phenotypeTraits;
}

function updateResult() {
    const sex = document.getElementById('offspringssex').value;
    const combined = ['dad', 'mom', 'coat-type', 'pattern'].map(id => document.getElementById(id).value).join('');
    const traits = figureoutlooks(combined, sex);
    
    let baseGenotype = traits.filter(t => !["ll", "rxrx", "Sasa", "hrhr", "Ba", "Ds", "rd", "Wh", "ss", "Toto"].includes(t)).sort().join('') || "++";

    let baseName = "Golden Agouti";
    const lookup = document.getElementById('offspring-phenotype-list');
    for (let opt of lookup.options) {
        if (opt.value === baseGenotype) { baseName = opt.text; break; }
    }

    let modifiers = [];
    if (traits.includes("Ba")) modifiers.push("Banded");
    if (traits.includes("Ds")) modifiers.push("Dominant Spot");
    if (traits.includes("Wh")) modifiers.push("Roan");
    if (traits.includes("Toto")) modifiers.push("Tortoiseshell");
    
    let texture = traits.includes("ll") ? "Longhair" : traits.includes("rxrx") ? "Rex" : traits.includes("Sasa") ? "Satin" : traits.includes("hrhr") ? "Hairless" : "Shorthair";

    document.getElementById('offspring-result-name').innerText = `${baseName} ${modifiers.join(' ')} ${texture}`.replace(/\s+/g, ' ').trim();
    document.getElementById('genotype-label').innerText = `Genotype: ${traits.join(' ')}`;
    document.getElementById('offspring-visual').src = `images/${baseGenotype}.png`;
}

['offspringssex', 'dad', 'mom', 'coat-type', 'pattern', 'eye-color'].forEach(id => document.getElementById(id).onchange = updateResult);
updateResult();
</script>